AcctSeed.ASModule=function(i,l){"use strict";function n(e,t){return new Promise(function(a,n){Visualforce.remoting.Manager.invokeAction(l.clearAction,e,t,function(e,t){t.status?a(e):n(t)},{timeout:12e4,buffer:!1})})}function e(e){return new Promise(function(a,n){Visualforce.remoting.Manager.invokeAction(l.unclearAction,e,function(e,t){t.status?a(e):n(t)},{timeout:12e4,buffer:!1})})}function c(e,t){for(var a=0,n=e.length,c=[],a=0;a<n;a+=t){var r=e.slice(a,a+t);c.push(r)}return c}var o,u,d=l.currencyFormatterProxy,s=!1,h="",f=void 0!==l.currencyIsoCode?l.currencyIsoCode:"USD",a=l.packageQualifier,g=!1,r=(l.setClearedDateSelected=function(e){var t=e.id.split(":")[1],t=i('[id$=":'+t+':unclearedClearedDateInput"]');e.checked?(e=i(t.parent().siblings()[2]).text(),t.val(void 0===t.val()||""===t.val()?e:t.val())):t.val("")},l.setCheckByClearedDate=function(e){e.forEach(function(e){void 0!==e.clearedDate&&""!==e.clearedDate&&(e.selected=!0)})},l.setClearedDateUnselected=function(e){var t=e.id.split(":")[4],t=i('[id$=":'+t+':unclearedCheckbox1"]');t.prop("checked")&&""===e.val()&&t.prop("checked",!1)},l.setClearedDateUnselectedAll=function(e){i('[id$=":'+e+'"]').each(function(){l.setClearedDateSelected(this)})},l.selectOrDeselectAll=function(e,t){i('[id$=":'+t+'"]').add("."+t).prop("checked",i('[id="'+e+'"]').add("."+t).prop("checked"))},l.setSelectAllUnchecked=function(e){i('[id$=":'+e+'"]').prop("checked",!1)},l.clearBankReconciliations=function(){var t,e=i("#bankRecId").val(),d=[],a=void 0!==o?o.data().length:0;s=!1,h="",u.rows().every(function(e,t,a){var n=this.node(),c=this.data(),r=i(n).find(".unclearedCheckbox");i(r).prop("checked")&&(c.selected=!0,c.clearedDate=i(n).find('[id*="unclearedClearedDateInput"]').val(),c.clearedDate=c.clearedDate||"Date field cannot be empty.",d.push($(v(c))))}),4e3<a+d.length?(AcctSeed.ASModule.pageLoad(),s=!0):0<d.length?(t=[],c(d,500).forEach(function(e){t.push(e)}),n(t[0],e).then(function(){return 1<t.length?n(t[1],e):Promise.resolve()}).then(function(e){l.pageLoad(),i('[id$=":unclearedSuccess"]').show()}).catch(function(e){l.pageLoad(),g=!0,p(e)})):l.pageLoad()},l.unclearBankReconciliations=function(){i('[id$="thePanel"]').hide();var t,r=[];s=!1,h="",o.rows().every(function(e,t,a){var n=this.node(),c=this.data(),n=i(n).find(".clearedCheckbox");i(n).prop("checked")&&(c.selected=!0,r.push($(v(c))))}),0<r.length?(t=[],c(r,500).forEach(function(e){t.push(e)}),e(t[0]).then(function(){return 1<t.length?e(t[1]):Promise.resolve()}).then(function(){l.pageLoad(),i('[id$=":clearedSuccess"]').show()}).catch(function(e){p(e)})):l.pageLoad()},l.getClearedBankReconciliations=function(){var e=i("#bankRecId").val();Visualforce.remoting.Manager.invokeAction(l.getClearedBankReconciliationAction,e,"All",f,l.bankRecLedgerId,function(e,t){t.status?(void 0!==e&&0<e.length?(r(e),i("#clearLRDate2").html(o.column(1).data()[0]),i("#clearMRDate2").html(o.column(1).data()[o.column(1).data().length-1]),i('[id$="lrcdlabel"]').show(),i('[id$="mrcdlabel"]').show(),i('[id$="noClearedRecords"]').hide(),i('[id$="unclearButton"]').show()):(i('[id$="noClearedRecords"]').show(),i('[id$="unclearButton"]').hide(),void 0!==o&&o.clear()),l.calculateDepositsAndDisbursements()):p(t)},{escape:!1,timeout:12e4})},function(e){void 0!==o&&o.clear(),o=i("#clearedTable").DataTable({data:e,lengthMenu:[[10,25,50,100,500],[10,25,50,100,500]],pageLength:100,columns:[{title:'<input id="clearedCheckboxHeader" type="checkbox"/>',data:"selected"},{title:"Bank Transaction Date",data:"clearedDate"},{title:"Customer/Payee",data:"entity"},{title:"Date",data:"documentDate"},{title:"Amount",data:"amount",className:"dt-right"},{title:"Reference",data:"reference"},{title:"Source",data:"sourceObj"}],columnDefs:[{searchable:!1,orderable:!1,targets:0,render:function(e,t,a,n){return'<input class="clearedCheckbox" onchange="AcctSeed.ASModule.checkSelectedClearedLimit()" type="checkbox"/>'}},{targets:4,render:function(e,t,a,n){return"sort"===t||"type"===t?e:d(e)}},{targets:6,render:function(e,t,a,n){return'<a target="_blank" href="'+e.baseURL+"/"+e.sourceId+'">'+e.sourceType+"</a>"}}],order:[[1,"asc"]]}),i("#clearedCheckboxHeader").on("change",function(){l.selectOrDeselectAll(this.id,"clearedCheckbox"),l.checkSelectedClearedLimit()})}),m=(l.checkSelectedClearedLimit=function(){1e3<l.checkedCount(o,".clearedCheckbox")?(i('[id$="selectClearedLimitError"]').show(),i('[id$=":unclearButton"]').hide()):(i('[id$="selectClearedLimitError"]').hide(),i('[id$=":unclearButton"]').show())},l.checkedCount=function(e,c){var r=0;return e.rows().every(function(e,t,a){var n=i(this.node()).find(c);i(n).prop("checked")&&r++}),r},l.searchRecords=function(){var e=i('[id$="unclearedType"]').val(),t=i('[id$="startDate"]').is("input")?i('[id$="startDate"]').val():i('[id$="startDate"]').html(),a=i('[id$="endDate"]').is("input")?i('[id$="endDate"]').val():i('[id$="endDate"]').html(),n=i("#bankAccountId").val(),c=void 0!==i('[id$="glavVar1"]').val()?i('[id$="glavVar1"]').val():"",r=void 0!==i('[id$="glavVar2"]').val()?i('[id$="glavVar2"]').val():"",d=void 0!==i('[id$="glavVar3"]').val()?i('[id$="glavVar3"]').val():"",o=void 0!==i('[id$="glavVar4"]').val()?i('[id$="glavVar4"]').val():"";h="",s=!1,i('[id$="loadingImage"]').show(),Visualforce.remoting.Manager.invokeAction(l.searchRecordsAction,e,t,a,n,c,r,d,o,4e3,f,l.bankRecLedgerId,function(e,t){t.status?(void 0!==e&&0<e.length?(m(e),g?i('[id$="errorPanel"]').show():i('[id$="errorPanel"]').hide(),i('[id$=":clearButton"]').show(),i('[id$="overSizeUncleared"]').hide(),g=!1):void 0!==u&&u.clear(),void 0!==e&&4e3<=e.length&&i('[id$="overSizeUncleared"]').show()):p(t);l.getClearedBankReconciliations()},{escape:!1,timeout:12e4})},function(e){var r=0;void 0!==u&&u.clear(),l.setCheckByClearedDate(e),u=i("#unclearedTable").DataTable({data:e,lengthMenu:[[10,25,50,100,500],[10,25,50,100,500]],pageLength:100,columns:[{title:'<input id="unclearedCheckboxHeader" type="checkbox"/>',data:"selected"},{title:"Bank Transaction Date",data:"clearedDate"},{title:"Customer/Payee",data:"entity"},{title:"Date",data:"documentDate"},{title:"Amount",data:"amount",className:"dt-right"},{title:"Reference",data:"reference"},{title:"Source",data:"sourceObj"}],columnDefs:[{searchable:!1,orderable:!1,targets:0,render:function(e,t,a,n){return'<input class="unclearedCheckbox" id="'+(":"+r+":unclearedCheckbox")+'" onchange="AcctSeed.ASModule.setClearedDateSelected(this); AcctSeed.ASModule.checkSelectedUnclearedLimit()" type="checkbox" '+(e?"checked":"")+"/>"}},{targets:1,orderable:!1,render:function(e,t,a,n){var c=":"+r+++":unclearedClearedDateInput";return'<input size="10" id="'+c+'" onfocus="DatePicker.pickDate(false, \''+c+'\', false);" value="'+(e||"")+'"/>'}},{targets:4,render:function(e,t,a,n){return"sort"===t||"type"===t?e:d(e)}},{targets:6,render:function(e,t,a,n){return'<a target="_blank" href="'+e.baseURL+"/"+e.sourceId+'">'+e.sourceType+"</a>"}}],order:[[3,"asc"]]}),i("#unclearedCheckboxHeader").on("change",function(){l.selectOrDeselectAll(this.id,"unclearedCheckbox"),l.checkSelectedUnclearedLimit(),i('[id$="unclearedCheckbox"]').each(function(){AcctSeed.ASModule.setClearedDateSelected(this)})})}),p=(l.checkSelectedUnclearedLimit=function(){1e3<l.checkedCount(u,".unclearedCheckbox")?(i('[id$="selectUnclearedLimitError"]').show(),i('[id$=":clearButton"]').hide()):(i('[id$="selectUnclearedLimitError"]').hide(),i('[id$=":clearButton"]').show())},l.calculateDepositsAndDisbursements=function(){var e=i("#bankRecId").val();Visualforce.remoting.Manager.invokeAction(l.calculateDepositsAndDisbursementsAction,e,function(e,t){t.status?(i('[id$="begBalanceAmount"]').text(d(i('[id$="begBalanceAmount"]').text())),i('[id$="clearedDepositAmount"]').text(d(e[l.packageQualifier+"Cleared_Deposits__c"])),i('[id$="clearedDisbursmentAmount"]').text(d(e[l.packageQualifier+"Cleared_Disbursements__c"])),i('[id$="calBegBalanceAmount"]').text(d(e[l.packageQualifier+"Beginning_Balance__c"])),i('[id$="unclearedAmount"]').text(d(e[l.packageQualifier+"Ending_Balance__c"])),i('[id$="endBalanceAmount"]').text(d(i('[id$="endBalanceAmount"]').text())),i('[id$="begBalanceAmount"]').show(),i('[id$="clearedDepositAmount"]').show(),i('[id$="clearedDisbursmentAmount"]').show(),i('[id$="calBegBalanceAmount"]').show(),i('[id$="unclearedAmount"]').show(),i('[id$="endBalanceAmount"]').show()):p(t);i('[id$="loadingImage"]').hide(),i('[id$="thePanel"]').show(),l.showMessages()},{timeout:12e4})},function(e){e.type,t(e),i('[id$="loadingImage"]').hide(),i('[id$="thePanel"]').hide()}),t=function(e){i('[id$="errorPanel"]').show(),i('[id$="errorPanel"]').find("h4").html("Error: "+e.message)},v=(l.showMessages=function(e){(void 0===u||0===u.column(1).data().length?(i('[id$="noUnclearedRecords"]').show(),i('[id$=":clearButton"]')):i('[id$="noUnclearedRecords"]')).hide(),void 0===o||0===o.column(1).data().length?(i('[id$="noClearedRecords"]').show(),i('[id$="unclearButton"]').hide()):(i('[id$="noClearedRecords"]').hide(),i('[id$="unclearButton"]').show()),s?i('[id$="lineLimitError"]').show():i('[id$="lineLimitError"]').hide(),""!==h&&(i('[id$="errorPanel"]').show(),i('[id$="errorPanel"]').find("h4").html("Error: "+h))},function(t){return["Reference__c","Ledger_Amount__c","Amount__c","Account__c","Journal_Entry__c","Payee__c","Deposit_Reference__c","Name","Payment_Reference__c"].forEach(function(e){t.obj.hasOwnProperty(a+e)&&delete t.obj[a+e]}),t.cr={},t.sourceObj={},t.reference="",t.documentDate="",t.entity="",t}),$=function(e){return e.obj.hasOwnProperty("Cash_Receipts__r")?delete e.obj.Cash_Receipts__r:e.obj.hasOwnProperty("AcctSeed__Cash_Receipts__r")&&delete e.obj.AcctSeed__Cash_Receipts__r,e.obj.hasOwnProperty("Account__r")?delete e.obj.Account__r:e.obj.hasOwnProperty("AcctSeed__Account__r")&&delete e.obj.AcctSeed__Account__r,e};return l.pageLoad=function(){l.searchRecords()},i(function(){i.fn.dataTable.moment("DD/MM/YYYY",l.defaultLocale),l.pageLoad()}),l}((window,document,$j),AcctSeed.ASModule);