!function(m){"use strict";var e={tagClass:function(t){return"label label-info"},focusClass:"focus",itemValue:function(t){return t&&t.toString()},itemText:function(t){return this.itemValue(t)},itemTitle:function(t){return null},freeInput:!0,addOnBlur:!0,maxTags:10,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!1,onTagExists:function(t,e){e.hide().fadeIn()},trimValue:!0,allowDuplicates:!1,triggerChange:!0,validateEmail:!0};function r(t,e){this.isInit=!0,this.itemsArray=[],this.$element=m(t),this.$element.hide(),this.isSelect="SELECT"===t.tagName,this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=e&&e.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=m('<div class="bootstrap-tagsinput"></div>'),this.$input=m('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(e),this.isInit=!1}function i(t,e){var n;"function"!=typeof t[e]&&(n=t[e],t[e]=function(t){return t[n]})}function o(t,e){var n;"function"!=typeof t[e]&&(n=t[e],t[e]=function(){return n})}r.prototype={constructor:r,add:function(t,e,n){var i=this;if(!(i.options.maxTags&&i.itemsArray.length>=i.options.maxTags)&&(!1===t||t)){if("object"==typeof(t="string"==typeof t&&i.options.trimValue?m.trim(t):t)&&!i.objectItems)throw"Can't add objects when itemValue option is not set";if(!t.toString().match(/^\s*$/)){if(i.isSelect&&!i.multiple&&0<i.itemsArray.length&&i.remove(i.itemsArray[0]),"string"==typeof t&&"INPUT"===this.$element[0].tagName){var a=i.options.delimiterRegex||i.options.delimiter,o=t.split(a);if(1<o.length){for(var r=0;r<o.length;r++)this.add(o[r],!0);return void(e||i.pushVal(i.options.triggerChange))}}var s,a=!1,l=(i.options.validateEmail&&(u=t,a=!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(u)),i.options.itemValue(t)),u=i.options.itemText(t),p=i.options.tagClass(t),c=i.options.itemTitle(t),h=m.grep(i.itemsArray,function(t){return i.options.itemValue(t)===l})[0];h&&!i.options.allowDuplicates?i.options.onTagExists&&(s=m(".tag",i.$container).filter(function(){return m(this).data("item")===h}),i.options.onTagExists(t,s)):i.items().toString().length+t.length+1>i.options.maxInputLength||(s=m.Event("beforeItemAdd",{item:t,cancel:!1,options:n}),i.$element.trigger(s),s.cancel||(i.itemsArray.push(t),(s=m('<span class="tag '+(a?"notValid":"")+" "+d(p)+(null!==c?'" title="'+c:"")+'">'+d(u)+'<span data-role="remove"></span></span>')).data("item",t),i.findInputWrapper().before(s),s.after(" "),a=m('option[value="'+encodeURIComponent(l)+'"]',i.$element).length||m('option[value="'+d(l)+'"]',i.$element).length,i.isSelect&&!a&&((p=m("<option selected>"+d(u)+"</option>")).data("item",t),p.attr("value",l),i.$element.append(p)),e||i.pushVal(i.options.triggerChange),i.options.maxTags!==i.itemsArray.length&&i.items().toString().length!==i.options.maxInputLength||i.$container.addClass("bootstrap-tagsinput-max"),m(".typeahead, .twitter-typeahead",i.$container).length&&i.$input.typeahead("val",""),this.isInit?i.$element.trigger(m.Event("itemAddedOnInit",{item:t,options:n})):i.$element.trigger(m.Event("itemAdded",{item:t,options:n}))))}}},remove:function(e,t,n){var i=this;if(e=i.objectItems?(e="object"==typeof e?m.grep(i.itemsArray,function(t){return i.options.itemValue(t)==i.options.itemValue(e)}):m.grep(i.itemsArray,function(t){return i.options.itemValue(t)==e}))[e.length-1]:e){var a=m.Event("beforeItemRemove",{item:e,cancel:!1,options:n});if(i.$element.trigger(a),a.cancel)return;m(".tag",i.$container).filter(function(){return m(this).data("item")===e}).remove(),m("option",i.$element).filter(function(){return m(this).data("item")===e}).remove(),-1!==m.inArray(e,i.itemsArray)&&i.itemsArray.splice(m.inArray(e,i.itemsArray),1)}t||i.pushVal(i.options.triggerChange),i.options.maxTags>i.itemsArray.length&&i.$container.removeClass("bootstrap-tagsinput-max"),i.$element.trigger(m.Event("itemRemoved",{item:e,options:n}))},removeAll:function(){var t=this;for(m(".tag",t.$container).remove(),m("option",t.$element).remove();0<t.itemsArray.length;)t.itemsArray.pop();t.pushVal(t.options.triggerChange)},refresh:function(){var o=this;m(".tag",o.$container).each(function(){var t=m(this),e=t.data("item"),n=o.options.itemValue(e),i=o.options.itemText(e),a=o.options.tagClass(e);t.attr("class",null),t.addClass("tag "+d(a)),t.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=d(i),o.isSelect&&m("option",o.$element).filter(function(){return m(this).data("item")===e}).attr("value",n)})},items:function(){return this.itemsArray},pushVal:function(){var e=this,t=m.map(e.items(),function(t){return e.options.itemValue(t).toString()});e.$element.val(t,!0),e.options.triggerChange&&e.$element.trigger("change")},build:function(t){var n,a,s=this;s.options=m.extend({},e,t),s.objectItems&&(s.options.freeInput=!1),i(s.options,"itemValue"),i(s.options,"itemText"),o(s.options,"tagClass"),s.options.typeahead&&(o(n=s.options.typeahead||{},"source"),s.$input.typeahead(m.extend({},n,{source:function(t,a){function e(t){for(var e=[],n=0;n<t.length;n++){var i=s.options.itemText(t[n]);o[i]=t[n],e.push(i)}a(e)}this.map={};var o=this.map,t=n.source(t);m.isFunction(t.success)?t.success(e):(m.isFunction(t.then)?t:m.when(t)).then(e)},updater:function(t){return s.add(this.map[t]),this.map[t]},matcher:function(t){return-1!==t.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(t){return t.sort()},highlighter:function(t){var e=new RegExp("("+this.query+")","gi");return t.replace(e,"<strong>$1</strong>")}}))),s.options.typeaheadjs&&(a=s.options.typeaheadjs,m.isArray(a)||(a=[null,a]),m.fn.typeahead.apply(s.$input,a).on("typeahead:selected",m.proxy(function(t,e,n){var i=0;a.some(function(t,e){return t.name===n&&(i=e,!0)}),a[i].valueKey?s.add(e[a[i].valueKey]):s.add(e),s.$input.typeahead("val","")},s))),s.$container.on("click",m.proxy(function(t){s.$element.attr("disabled")||s.$input.removeAttr("disabled"),s.$input.focus()},s)),s.options.addOnBlur&&s.options.freeInput&&s.$input.on("focusout",m.proxy(function(t){0===m(".typeahead, .twitter-typeahead",s.$container).length&&(s.add(s.$input.val()),s.$input.val(""))},s)),s.$container.on({focusin:function(){s.$container.addClass(s.options.focusClass)},focusout:function(){s.$container.removeClass(s.options.focusClass)}}),s.$container.on("keydown","input",m.proxy(function(t){var e=m(t.target),n=s.findInputWrapper();if(s.$element.attr("disabled"))s.$input.attr("disabled","disabled");else{switch(t.which){case 8:0!==l(e[0])||(i=n.prev()).length&&s.remove(i.data("item"));break;case 46:0!==l(e[0])||(i=n.next()).length&&s.remove(i.data("item"));break;case 37:var i=n.prev();0===e.val().length&&i[0]&&(i.before(n),e.focus());break;case 39:i=n.next();0===e.val().length&&i[0]&&(i.after(n),e.focus())}t=e.val().length;Math.ceil(t/5);e.attr("size",Math.max(this.inputSize,e.val().length))}},s)),s.$container.on("keypress","input",m.proxy(function(t){var e,n,a,o,i,r=m(t.target);s.$element.attr("disabled")?s.$input.attr("disabled","disabled"):(e=r.val(),n=s.options.maxChars&&e.length>=s.options.maxChars,s.options.freeInput&&(a=t,i=s.options.confirmKeys,o=!1,m.each(i,function(t,e){if("number"==typeof e&&a.which===e)return!(o=!0);if(a.which===e.which){var n=!e.hasOwnProperty("altKey")||a.altKey===e.altKey,i=!e.hasOwnProperty("shiftKey")||a.shiftKey===e.shiftKey,e=!e.hasOwnProperty("ctrlKey")||a.ctrlKey===e.ctrlKey;if(n&&i&&e)return!(o=!0)}}),(o||n)&&(0!==e.length&&(s.add(n?e.substr(0,s.options.maxChars):e),r.val("")),!1===s.options.cancelConfirmKeysOnEmpty&&t.preventDefault())),i=r.val().length,Math.ceil(i/5),r.attr("size",Math.max(this.inputSize,r.val().length)))},s)),s.$container.on("click","[data-role=remove]",m.proxy(function(t){s.$element.attr("disabled")||s.remove(m(t.target).closest(".tag").data("item"))},s)),s.options.itemValue===e.itemValue&&("INPUT"===s.$element[0].tagName?s.add(s.$element.val()):m("option",s.$element).each(function(){s.add(m(this).attr("value"),!0)}))},destroy:function(){var t=this;t.$container.off("keypress","input"),t.$container.off("click","[role=remove]"),t.$container.remove(),t.$element.removeData("tagsinput"),t.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var t=this.$input[0],e=this.$container[0];t&&t.parentNode!==e;)t=t.parentNode;return m(t)}},m.fn.tagsinput=function(n,i,a){var o=[];return this.each(function(){var t,e=m(this).data("tagsinput");e?n||i?void 0!==e[n]&&void 0!==(t=3===e[n].length&&void 0!==a?e[n](i,null,a):e[n](i))&&o.push(t):o.push(e):(e=new r(this,n),m(this).data("tagsinput",e),o.push(e),"SELECT"===this.tagName&&m("option",m(this)).attr("selected","selected"),m(this).val(m(this).val()))}),"string"!=typeof n||1<o.length?o:o[0]},m.fn.tagsinput.Constructor=r;var n=m("<div />");function d(t){return t?n.text(t).html():""}function l(t){var e,n=0;return document.selection?(t.focus(),(e=document.selection.createRange()).moveStart("character",-t.value.length),n=e.text.length):!t.selectionStart&&"0"!=t.selectionStart||(n=t.selectionStart),n}m(function(){m("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);